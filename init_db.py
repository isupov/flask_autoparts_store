from app import create_app, db
from app.models import User, Category, Brand, Country, Product, News
import os


def init_database():
    app = create_app()
    with app.app_context():
        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
        db.create_all()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ
        if User.query.first() is None:
            print("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")

            # –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            admin = User(username='admin', email='admin@example.com', is_admin=True)
            admin.set_password('admin123')  # –¢–µ–ø–µ—Ä—å –º–µ—Ç–æ–¥ –µ—Å—Ç—å
            db.session.add(admin)

            # –°–æ–∑–¥–∞–µ–º –±—Ä–µ–Ω–¥—ã
            brands_data = ['Bosch', 'Continental', 'Michelin', 'Castrol', 'Mobil', 'Shell', 'Motul']
            brands = []
            for brand_name in brands_data:
                brand = Brand(name=brand_name)
                db.session.add(brand)
                brands.append(brand)

            # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞–Ω—ã
            countries_data = ['–ì–µ—Ä–º–∞–Ω–∏—è', '–§—Ä–∞–Ω—Ü–∏—è', '–Ø–ø–æ–Ω–∏—è', '–°–®–ê', '–ö–∏—Ç–∞–π', '–†–æ—Å—Å–∏—è', '–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è']
            countries = []
            for country_name in countries_data:
                country = Country(name=country_name)
                db.session.add(country)
                countries.append(country)

            # –°–æ–∑–¥–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            parent_categories_data = [
                ('–§–∏–ª—å—Ç—Ä—ã', None),
                ('–ê–≤—Ç–æ–∫–æ—Å–º–µ—Ç–∏–∫–∞', None),
                ('–ú–æ—Ç–æ—Ä–Ω—ã–µ –º–∞—Å–ª–∞', None),
                ('–¢–æ—Ä–º–æ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞', None),
                ('–ü–æ–¥–≤–µ—Å–∫–∞', None)
            ]

            parent_categories = {}
            for name, parent_id in parent_categories_data:
                category = Category(name=name, parent_id=parent_id)
                db.session.add(category)
                db.session.flush()  # –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ID
                parent_categories[name] = category

            # –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            subcategories_data = [
                ('–ú–∞—Å–ª—è–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã', parent_categories['–§–∏–ª—å—Ç—Ä—ã'].id),
                ('–í–æ–∑–¥—É—à–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã', parent_categories['–§–∏–ª—å—Ç—Ä—ã'].id),
                ('–¢–æ–ø–ª–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã', parent_categories['–§–∏–ª—å—Ç—Ä—ã'].id),
                ('–û—á–∏—Å—Ç–∏—Ç–µ–ª–∏ —Å–∞–ª–æ–Ω–∞', parent_categories['–ê–≤—Ç–æ–∫–æ—Å–º–µ—Ç–∏–∫–∞'].id),
                ('–ü–æ–ª–∏—Ä–æ–ª–∏', parent_categories['–ê–≤—Ç–æ–∫–æ—Å–º–µ—Ç–∏–∫–∞'].id),
                ('–®–∞–º–ø—É–Ω–∏ –¥–ª—è –∞–≤—Ç–æ', parent_categories['–ê–≤—Ç–æ–∫–æ—Å–º–µ—Ç–∏–∫–∞'].id),
                ('–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Å–ª–∞', parent_categories['–ú–æ—Ç–æ—Ä–Ω—ã–µ –º–∞—Å–ª–∞'].id),
                ('–ü–æ–ª—É—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Å–ª–∞', parent_categories['–ú–æ—Ç–æ—Ä–Ω—ã–µ –º–∞—Å–ª–∞'].id),
                ('–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –º–∞—Å–ª–∞', parent_categories['–ú–æ—Ç–æ—Ä–Ω—ã–µ –º–∞—Å–ª–∞'].id)
            ]

            subcategories = {}
            for name, parent_id in subcategories_data:
                category = Category(name=name, parent_id=parent_id)
                db.session.add(category)
                db.session.flush()
                subcategories[name] = category

            # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
            news_data = [
                {
                    'title': '–ù–æ–≤—ã–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∑–∞–ø—á–∞—Å—Ç–µ–π',
                    'content': '<p>–ú—ã –ø–æ–ø–æ–ª–Ω–∏–ª–∏ —Å–∫–ª–∞–¥ –Ω–æ–≤—ã–º–∏ –∑–∞–ø—á–∞—Å—Ç—è–º–∏ –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Ä–æ–∫. –í –Ω–∞–ª–∏—á–∏–∏ —Ñ–∏–ª—å—Ç—Ä—ã, –º–∞—Å–ª–∞ –∏ –¥—Ä—É–≥–∏–µ –∞–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏ –æ—Ç –≤–µ–¥—É—â–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.</p><p>–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã –º–µ—Å—è—Ü–∞!</p>'
                },
                {
                    'title': '–°–∫–∏–¥–∫–∏ –Ω–∞ –∑–∏–º–Ω–∏–µ —à–∏–Ω—ã',
                    'content': '<p>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∑–∏–º–Ω–∏–µ —à–∏–Ω—ã Continental –∏ Michelin –¥–æ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞. –°–∫–∏–¥–∫–∏ –¥–æ 30% –Ω–∞ –≤–µ—Å—å –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç!</p><p>–£—Å–ø–µ–π—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –ø–æ –≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º!</p>'
                },
                {
                    'title': '–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –∞–≤—Ç–æ–∫–æ—Å–º–µ—Ç–∏–∫–∏',
                    'content': '<p>–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª –∞–≤—Ç–æ–∫–æ—Å–º–µ—Ç–∏–∫–∏ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç! –í –ø—Ä–æ–¥–∞–∂–µ –æ—á–∏—Å—Ç–∏—Ç–µ–ª–∏ —Å–∞–ª–æ–Ω–∞, –ø–æ–ª–∏—Ä–æ–ª–∏, —à–∞–º–ø—É–Ω–∏ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.</p><p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ —É—Ö–æ–¥—É –∑–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º —Ü–µ–Ω–∞–º.</p>'
                }
            ]

            for news_item in news_data:
                news = News(title=news_item['title'], content=news_item['content'])
                db.session.add(news)

            db.session.commit()

            # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
            products_data = [
                {
                    'name': '–í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä Bosch',
                    'article': 'AF-12345',
                    'short_desc': '–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π',
                    'full_desc': '<p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä Bosch –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –≤–æ–∑–¥—É—Ö–∞, –ø–æ—Å—Ç—É–ø–∞—é—â–µ–≥–æ –≤ –¥–≤–∏–≥–∞—Ç–µ–ª—å.</p><p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong></p><ul><li>–í—ã—Å–æ–∫–∞—è —Å—Ç–µ–ø–µ–Ω—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</li><li>–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å</li><li>–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</li></ul>',
                    'price': 1299.99,
                    'stock': 50,
                    'brand_id': brands[0].id,  # Bosch
                    'country_id': countries[0].id,  # –ì–µ—Ä–º–∞–Ω–∏—è
                },
                {
                    'name': '–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä Mann-Filter',
                    'article': 'OF-67890',
                    'short_desc': '–§–∏–ª—å—Ç—Ä –º–∞—Å–ª—è–Ω—ã–π –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞',
                    'full_desc': '<p>–ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä Mann-Filter –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –æ—á–∏—Å—Ç–∫—É –º–∞—Å–ª–∞ –∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è.</p><p><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong></p><ul><li>–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å</li><li>–ù–∞–¥–µ–∂–Ω–∞—è –≥–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è</li><li>–î–æ–ª–≥–∏–π —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã</li></ul>',
                    'price': 899.50,
                    'stock': 30,
                    'brand_id': brands[1].id,  # Continental
                    'country_id': countries[1].id,  # –§—Ä–∞–Ω—Ü–∏—è
                },
                {
                    'name': '–û—á–∏—Å—Ç–∏—Ç–µ–ª—å —Å–∞–ª–æ–Ω–∞ Meguiar\'s',
                    'article': 'CL-54321',
                    'short_desc': '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—á–∏—Å—Ç–∏—Ç–µ–ª—å –¥–ª—è —Å–∞–ª–æ–Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è',
                    'full_desc': '<p>–û—á–∏—Å—Ç–∏—Ç–µ–ª—å —Å–∞–ª–æ–Ω–∞ Meguiar\'s —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–¥–∞–ª—è–µ—Ç –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π —Å–∞–ª–æ–Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è.</p><p><strong>–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:</strong></p><ul><li>–ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã—Ö –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π</li><li>–†–µ–∑–∏–Ω–æ–≤—ã—Ö –≤—Å—Ç–∞–≤–æ–∫</li><li>–¢–∫–∞–Ω–µ–≤–æ–π –æ–±–∏–≤–∫–∏</li><li>–ö–æ–≤—Ä–æ–≤—ã—Ö –ø–æ–∫—Ä—ã—Ç–∏–π</li></ul>',
                    'price': 1599.00,
                    'stock': 25,
                    'brand_id': brands[6].id,  # Motul
                    'country_id': countries[3].id,  # –°–®–ê
                },
                {
                    'name': '–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å–ª–æ Castrol',
                    'article': 'MO-98765',
                    'short_desc': '–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –º–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ –ø—Ä–µ–º–∏—É–º –∫–ª–∞—Å—Å–∞',
                    'full_desc': '<p>–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –º–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ Castrol –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω—É—é –∑–∞—â–∏—Ç—É –¥–≤–∏–≥–∞—Ç–µ–ª—è –≤ –ª—é–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.</p><p><strong>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong></p><ul><li>–í—è–∑–∫–æ—Å—Ç—å 5W-30</li><li>–û–±—ä–µ–º 5 –ª–∏—Ç—Ä–æ–≤</li><li>–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º API SN</li><li>–≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–ø–ª–∏–≤–∞</li></ul>',
                    'price': 3299.99,
                    'stock': 40,
                    'brand_id': brands[3].id,  # Castrol
                    'country_id': countries[0].id,  # –ì–µ—Ä–º–∞–Ω–∏—è
                }
            ]

            # –°–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∏ —Å–≤—è–∑—ã–≤–∞–µ–º –∏—Ö —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
            for i, product_data in enumerate(products_data):
                product = Product(**product_data)
                db.session.add(product)
                db.session.flush()

                # –°–≤—è–∑—ã–≤–∞–µ–º —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
                if i == 0:  # –í–æ–∑–¥—É—à–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
                    product.categories.append(subcategories['–í–æ–∑–¥—É—à–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã'])
                elif i == 1:  # –ú–∞—Å–ª—è–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
                    product.categories.append(subcategories['–ú–∞—Å–ª—è–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã'])
                elif i == 2:  # –û—á–∏—Å—Ç–∏—Ç–µ–ª—å —Å–∞–ª–æ–Ω–∞
                    product.categories.append(subcategories['–û—á–∏—Å—Ç–∏—Ç–µ–ª–∏ —Å–∞–ª–æ–Ω–∞'])
                elif i == 3:  # –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å–ª–æ
                    product.categories.append(subcategories['–°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Å–ª–∞'])

            db.session.commit()

            print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
            print("üë§ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: –ª–æ–≥–∏–Ω 'admin', –ø–∞—Ä–æ–ª—å 'admin123'")
            print("üìä –°–æ–∑–¥–∞–Ω–æ:")
            print(f"   - {User.query.count()} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
            print(f"   - {Category.query.count()} –∫–∞—Ç–µ–≥–æ—Ä–∏–π")
            print(f"   - {Brand.query.count()} –±—Ä–µ–Ω–¥–æ–≤")
            print(f"   - {Country.query.count()} —Å—Ç—Ä–∞–Ω")
            print(f"   - {Product.query.count()} —Ç–æ–≤–∞—Ä–æ–≤")
            print(f"   - {News.query.count()} –Ω–æ–≤–æ—Å—Ç–µ–π")
        else:
            print("‚ö†Ô∏è  –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ")


if __name__ == '__main__':
    init_database()